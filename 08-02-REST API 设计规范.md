# Restful API 架构与设计参考原则
## （一）什么是REST
REST全称是Representational State Transfer，中文意思是表述（编者注：通常译为表征）性状态转移。 它首次出现在2000年Roy Fielding的博士论文中，Roy Fielding是HTTP规范的主要编写者之一。 他在论文中提到："我这篇文章的写作目的，就是想在符合架构原理的前提下，理解和评估以网络为基础的应用软件的架构设计，得到一个功能强、性能好、适宜通信的架构。REST指的是一组架构约束条件和原则。" 如果一个架构符合REST的约束条件和原则，我们就称它为RESTful架构。  
REST本身并没有创造新的技术、组件或服务，而隐藏在RESTful背后的理念就是使用Web的现有特征和能力， 更好地使用现有Web标准中的一些准则和约束。虽然REST本身受Web技术的影响很深， 但是理论上REST架构风格并不是绑定在HTTP上，只不过目前HTTP是唯一与REST相关的实例。 所以我们这里描述的REST也是通过HTTP实现的REST。  

##（二）什么是RESTful架构：  
每一个URI代表一种资源；  
客户端和服务器之间，传递这种资源的某种表现层；  
客户端通过四个HTTP动词（GET/POST/PUT/DELETE），对服务器端资源进行操作，实现”表现层状态转化”。  

## （三）URL
要让一个资源可以被识别，需要有个唯一标识，在Web中这个唯一标识就是URI(Uniform Resource Identifier)。 URI既可以看成是资源的地址，也可以看成是资源的名称。如果某些信息没有使用URI来表示，那它就不能算是一个资源， 只能算是资源的一些信息而已。URI的设计应该遵循可寻址性原则，具有自描述性，需要在形式上给人以直觉上的关联。  

## （四）HTTP动词
### 1. 使用GET、POST、PUT、DELETE这几种请求模式
请求模式也可以说是动作、数据传输方式，通常我们在web中的form有GET、POST两种，而在HTTP中，存在下发这几种。  
GET (选择)：从服务器上获取一个具体的资源或者一个资源列表。   
POST （创建）： 在服务器上创建一个新的资源。  
PUT（更新）：以整体的方式更新服务器上的一个资源。   
PATCH （更新）：只更新服务器上一个资源的一个属性。  
DELETE（删除）：删除服务器上的一个资源。  

### 2. 使用名词而不是动词
Rsource 资源  |GET 读 |POST 创建  |PUT 修改 |DELETE 删除
--------------|-------|-----------|--------|------------
/cars  |返回cars集合  |创建新的资源  |批量更新cars  |删除所有cars  
/cars/699  |返回特定的car  |该方法不允许（405）  |更新一个指定的资源  | 删除指定的资源

不要使用：  
/getAllCars  
/createNewCar  
/deleteAllRedCars  

### 3. Get方法和查询参数不应该涉及状态改变
使用PUT, POST 和DELETE 方法 而不是 GET 方法来改变状态，不要使用GET 进行状态改变:  
GET /users/711?activate   
GET /users/711/activate  

### 4. 使用复数名词
不要混淆名词单数和复数，为了保持简单，只对所有资源使用复数。  
/cars 而不是 /car  
/users 而不是 /user  
/products 而不是 /product  
/settings 而不是 /setting  

### 5. 使用子资源表达关系
如果一个资源与另外一个资源有关系，使用子资源：  
GET /cars/711/drivers/ 返回 car 711的所有司机  
GET /cars/711/drivers/4 返回 car 711的4号司机  

### 6.  为集合提供过滤 排序 选择和分页等功能
比如在数据过多, 需要对数据进行分页请求的时候, 我们应该统一 API 请求参数. 常见的有这些：  
limit=10 指定返回记录的数量。  
offset=10 指定返回记录的开始位置。  
page=2&per_page=100 指定第几页，以及每页的记录数。  
sortby=name&order=asc 指定返回结果按照哪个属性排序，以及排序顺序。  
animal_type_id=1 指定筛选条件。  

## （五）json数据类型
Number：整数或浮点数  
String：字符串  
Boolean：true 或 false  
Array：数组包含在方括号[]中  
Object：对象包含在大括号{}中  
Null：空类型  
传输的数据类型不能超过这六种数据类型。以前，我们曾经试过传输Date类型，它会转为类似于"2016年1月7日 09时17分42秒 GMT+08:00"这样的字符串，这在转换时会产生问题，不同的解析库解析方式可能不同，有的可能会转乱，有的可能直接异常了。要避免出错，必须做特殊处理，自己手动去做解析。为了根除这种问题，最好的解决方案是用毫秒数或者字符串表示日期。  

## （六）使用Http状态码处理错误
不同错误需要定义不同的返回码，属于客户端的错误和服务端的错误也要区分，比如1XX表示客户端的错误，2XX表示服务端的错误  
如果你的API没有错误处理是很难的，只是返回500和出错堆栈不一定有用  
Http状态码提供70个出错，我们只要使用10个左右：  
200 OK - [GET]：服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）。  
201 CREATED - [POST/PUT/PATCH]：用户新建或修改数据成功。  
202 Accepted - [ ]：表示一个请求已经进入后台排队（异步任务）  
204 NO CONTENT - [DELETE]：用户删除数据成功。  
400 INVALID REQUEST - [POST/PUT/PATCH]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的。  
401 Unauthorized - [ ]：表示用户没有权限（令牌、用户名、密码错误）。  
403 Forbidden - [ ] 表示用户得到授权（与401错误相对），但是访问是被禁止的。  
404 NOT FOUND - [ ]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。  
406 Not Acceptable - [GET]：用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）。  
410 Gone -[GET]：用户请求的资源被永久删除，且不会再得到的。  
422 Unprocesable entity - [POST/PUT/PATCH] 当创建一个对象时，发生一个验证错误。  
500 INTERNAL SERVER ERROR - [ ]：服务器发生错误，用户将无法判断发出的请求是否成功。  
